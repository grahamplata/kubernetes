version: "3"

tasks:
  install:
    desc: Install all developer dependencies
    deps:
      - requirements

  requirements:
    desc: Check required packages packages
    deps:
      - install-brew
    cmds:
      - task deps:need PACKAGE=cfssl
      - task deps:need PACKAGE=kubernetes-cli
      - task deps:need PACKAGE=helm
      - task deps:need PACKAGE=helmfile
      - task deps:need PACKAGE=sops
      - task deps:need PACKAGE=pv
      - task deps:need PACKAGE=terraform
      - task deps:need PACKAGE=chtf
      - task deps:need PACKAGE=go-task/tap/go-task
    silent: true

  need:
    desc: Check binary is present
    cmds:
      - command -v {{.PACKAGE}} >/dev/null || brew install --quiet {{.PACKAGE}}
    silent: true

  install-brew:
    desc: Install brew package manager
    cmds:
      - command -v brew >/dev/null || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    silent: true
